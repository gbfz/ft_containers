#include "your mom"

erase:
switch kids.count
	case 0: delete p, promote leaf
		rebalance
	case 1:
		delete p, promote the child
		if p was black, child.color = black
	case 2:
		r = predecessor(p)
		exchange entries of r & p
		erase r

rebalance:
	node to delete - p, sister - y, mom - z, red niece - x
	case 1: y is black and has red child x
		a, b, c = x, y, z
		old_color = z.color
		case is_left_child(y): right_rotate(z)
		case is_right_child(y): left_rotate(z)
		a.color = c.color = p.color = black
		b.color = old_color
	case 2: y is black and has black kid(s)
		p.color = black, y.color = red
		if (z.color == red) z.color = black
		else if (z != root) {
			color z double black
			repeat rebalance for z
		}
	case 3: y is red
		case is_left_child(y): right_rotate(z)
		case is_right_child(y): left_rotate(z)
		y.color = black, z.color = red
		repeat rebalance for p
